<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="API Reference" href="api.html" /><link rel="prev" title="Configuring" href="config.html" />

    <meta name="generator" content="sphinx-3.3.1, furo 2020.12.30.beta24"/>
        <title>Usage - cchdo.auth documentation</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=33d2fc4f3f180ec1ffc6524e273e21d7d58cbe49">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=26485485040e7aaf717c13fd0188a5ad2c2deb60">
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script defer="defer" src="_static/jquery.js"></script>
    <script defer="defer" src="_static/underscore.js"></script>
    <script defer="defer" src="_static/doctools.js"></script>
    <script defer="defer" src="_static/language_data.js"></script>
    <script defer src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">cchdo.auth  documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">cchdo.auth  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuring</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>Once <a class="reference internal" href="installation.html#installation"><span class="std std-ref">installed</span></a> and <a class="reference internal" href="config.html#configuring"><span class="std std-ref">configured</span></a> usage should be simple, even for existing code which relies on requests.</p>
<div class="section" id="preconfigured-session">
<h2>Preconfigured Session<a class="headerlink" href="#preconfigured-session" title="Permalink to this headline">¶</a></h2>
<p>The recommended way of using <code class="docutils literal notranslate"><span class="pre">cchdo.auth</span></code> is with the preconfigured <code class="docutils literal notranslate"><span class="pre">session</span></code> object.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cchdo.auth.session</span> <span class="kn">import</span> <span class="n">session</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>If you haven’t configured <code class="docutils literal notranslate"><span class="pre">cchdo.auth</span></code> yet, you will probably get the following warning:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cchdo.auth.session</span> <span class="kn">import</span> <span class="n">session</span>
<span class="go">An API Key could not be loaded from any source, many (not all) CCHDO API calls will fail</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>If this happens, do the <a class="reference internal" href="config.html#configuring"><span class="std std-ref">configuration</span></a> steps and restart your python session.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">session</span></code> object is a standard requests Session which has been configured with an auth provider:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span>
<span class="go">&lt;requests.sessions.Session object at 0x7f1e2ea67a60&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>The full requests API is available on it.
When a request is sent to the CCHDO API, authentication credentials will automatically be added.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://cchdo.ucsd.edu/api/v1/cruise"</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is safe to use this session with non CCHDO API URIs, the api key headers are only added when a request is sent to CCHDO.</p>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Do not alter the <code class="docutils literal notranslate"><span class="pre">.auth</span></code> property of the imported <code class="docutils literal notranslate"><span class="pre">session</span></code> object.
If you need to make authenticated requests to non CCHDO URIs, directly use <code class="docutils literal notranslate"><span class="pre">requests</span></code>.</p>
</div>
</div>
<div class="section" id="direct-auth-class-usage">
<h2>Direct Auth Class Usage<a class="headerlink" href="#direct-auth-class-usage" title="Permalink to this headline">¶</a></h2>
<p>The custom Auth class can also be used with <code class="docutils literal notranslate"><span class="pre">requests</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cchdo.auth</span> <span class="kn">import</span> <span class="n">CCHDOAuth</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cchdo_auth</span> <span class="o">=</span> <span class="n">CCHDOAuth</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://cchdo.ucsd.edu/api/v1/cruise"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">cchdo_auth</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
<p>This is more useful if you need to override the API Key for some reason:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cchdo.auth</span> <span class="kn">import</span> <span class="n">CCHDOAuth</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cchdo_auth</span> <span class="o">=</span> <span class="n">CCHDOAuth</span><span class="p">(</span><span class="s2">"custom_api_key"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://cchdo.ucsd.edu/api/v1/cruise"</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">cchdo_auth</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="use-in-existing-code">
<h2>Use in Existing Code<a class="headerlink" href="#use-in-existing-code" title="Permalink to this headline">¶</a></h2>
<p>Assuming you want to use the preconfigured <code class="docutils literal notranslate"><span class="pre">session</span></code> object everywhere, two things need to happen with existing code.</p>
<div class="section" id="use-cchdo-auth-session-instead-of-requests">
<h3>Use cchdo.auth.session instead of requests<a class="headerlink" href="#use-cchdo-auth-session-instead-of-requests" title="Permalink to this headline">¶</a></h3>
<p>All get, post, put, patch, etc… method calls need to be switched to use the session object.
This can be accomplished somewhat easily by aliasing the import.
For example, if you do something like the following:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">requests</span> <span class="k">as</span> <span class="nn">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"some_api_call"</span><span class="p">)</span>
</pre></div>
</div>
<p>You can simply alias the session object:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cchdo.auth.session</span> <span class="kn">import</span> <span class="n">session</span> <span class="k">as</span> <span class="n">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"some_api_call"</span><span class="p">)</span>
</pre></div>
</div>
<p>If you use requests directly:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"some_api_call"</span><span class="p">)</span>
</pre></div>
</div>
<p>Just alias the session to requests:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cchdo.auth.session</span> <span class="kn">import</span> <span class="n">session</span> <span class="k">as</span> <span class="n">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"some_api_call"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="remove-existing-auth-code">
<h3>Remove Existing Auth Code<a class="headerlink" href="#remove-existing-auth-code" title="Permalink to this headline">¶</a></h3>
<p>Since the preconfigured <code class="docutils literal notranslate"><span class="pre">session</span></code> object will handle putting http headers in the right place, you need to remove all existing API auth machinery from existing code.
This will most likely result in less code since the relevant parts just need to be deleted.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s2">"some_key here"</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://cchdo.ucsd.edu/api/v1/cruise"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">"X-Authentication-Token"</span><span class="p">:</span> <span class="n">API_KEY</span>
<span class="p">})</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
<p>should be changed to the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cchdo.auth.session</span> <span class="kn">import</span> <span class="n">session</span> <span class="k">as</span> <span class="n">requests</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://cchdo.ucsd.edu/api/v1/cruise"</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Reference</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="config.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Configuring</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020-2021, Regents of the University of California
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/usage.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#preconfigured-session">Preconfigured Session</a></li>
<li><a class="reference internal" href="#direct-auth-class-usage">Direct Auth Class Usage</a></li>
<li><a class="reference internal" href="#use-in-existing-code">Use in Existing Code</a><ul>
<li><a class="reference internal" href="#use-cchdo-auth-session-instead-of-requests">Use cchdo.auth.session instead of requests</a></li>
<li><a class="reference internal" href="#remove-existing-auth-code">Remove Existing Auth Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
  </body>
</html>